<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Padsala | Galaxy Focus</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- PWA Settings -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#0b1020">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

    <!-- GALAXY LAYERS -->
    <div class="galaxy-bg"></div>
    <div class="stars"></div>

    <div class="app-shell" id="app-shell">
        <header class="app-header">
            <div class="logo">
                <i data-lucide="zap" style="color: #a78bfa;"></i>
                PADSALA
            </div>
            <nav class="app-nav">
                <button class="nav-link active" onclick="switchView('home')" id="nav-home">Home</button>
                <button class="nav-link" onclick="switchView('dashboard')" id="nav-dashboard">Dashboard</button>
            </nav>
            <div id="current-bs-display" style="font-size: 0.8rem; opacity: 0.7;">System Ready</div>
        </header>

        <!-- VIEWS -->
        <div id="view-home" class="view-section active">
            <div class="stepper">
                <div class="step-indicator active" id="ind-1"></div>
                <div class="step-indicator" id="ind-2"></div>
                <div class="step-indicator" id="ind-3"></div>
                <div class="step-indicator" id="ind-4"></div>
            </div>

            <!-- 1. WELCOME -->
            <div id="step-1" class="step-container active">
                <div style="text-align: center; padding: 4rem 0;">
                    <h1 class="hero-title animate-in">Focus Beyond <br>Limits.</h1>
                    <p style="font-size: 1.25rem; color: #94a3b8; max-width: 600px; margin: 0 auto 3rem;">Enter a state
                        of
                        deep flow with the galaxy's most advanced study engine.</p>
                    <button class="btn-primary animate-in" onclick="navigateTo(2)">
                        Initialize Protocol <i data-lucide="arrow-right"></i>
                    </button>
                    <br><br>
                    <div style="opacity: 0.5;">
                        <button class="control-btn" onclick="enterFocus('Galaxy Simulation', 'System Test', 25)">
                            <i data-lucide="rocket"></i> Launch Focus Demo
                        </button>
                    </div>
                </div>
            </div>

            <!-- 2. SETUP -->
            <div id="step-2" class="step-container">
                <div class="glass-card">
                    <h2 style="margin-bottom: 2rem;">Configuration</h2>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin-bottom: 2rem;">
                        <div><label>University</label><select id="select-university"
                                onchange="updateFaculties()"></select>
                        </div>
                        <div><label>Faculty</label><select id="select-faculty" onchange="updateCourses()"></select>
                        </div>
                        <div><label>Program</label><select id="select-course" onchange="updateSemesters()"></select>
                        </div>
                        <div><label>Semester</label><select id="select-semester" onchange="updateSubjects()"></select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                        <div><label>Daily Load</label><input type="number" id="daily-hours" value="8"></div>
                        <div><label>Session</label><input type="number" id="session-duration" value="90"></div>
                        <div><label>Break</label><input type="number" id="break-duration" value="15"></div>
                        <div><label>Start</label><input type="time" id="start-time" value="06:00"></div>
                    </div>

                    <div id="subject-selection-zone" style="margin-top: 3rem; display: none;">
                        <h3 style="margin-bottom: 1rem;">Select Modules</h3>
                        <div id="subjects-grid"
                            style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
                        </div>
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn-primary" onclick="prepareDateInputs()">Next Phase <i
                                    data-lucide="arrow-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. DATES -->
            <div id="step-3" class="step-container">
                <div class="glass-card">
                    <h2 style="margin-bottom: 2rem;">Exam Timeline</h2>
                    <div id="exam-date-inputs" style="display: grid; gap: 1.5rem;"></div>
                    <button class="btn-primary" onclick="generateSchedule()"
                        style="margin-top: 2rem; width: 100%; justify-content: center;">Generate Blueprint</button>
                </div>
            </div>

            <!-- 4. BLUEPRINT (Inside Home for new generation) -->
            <div id="step-4" class="step-container">
                <div id="home-blueprint-content"></div>
            </div>
        </div> <!-- End view-home -->

        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="view-section">
            <div id="blueprint-content">
                <!-- If no schedule, show empty state -->
                <div class="glass-card" style="text-align: center; padding: 4rem 2rem;">
                    <i data-lucide="layout" style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.3;"></i>
                    <h2>No active plan found</h2>
                    <p style="opacity: 0.6; margin-bottom: 2rem;">Initialize your study protocol from the Home tab.</p>
                    <button class="btn-primary" onclick="switchView('home')">Start Setup Protocol</button>
                </div>
            </div>
        </div>

        <!-- GALAXY FOCUS OVERLAY -->
        <div id="focus-mode">
            <div class="focus-container">
                <!-- LEFT: TIMER -->
                <div class="timer-sector">
                    <div class="glow-ring-container">
                        <svg class="progress-ring" viewBox="0 0 350 350">
                            <defs>
                                <linearGradient id="neonGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" stop-color="#8b5cf6" />
                                    <stop offset="100%" stop-color="#d946ef" />
                                </linearGradient>
                                <filter id="glow">
                                    <feGaussianBlur stdDeviation="15" result="coloredBlur" />
                                    <feMerge>
                                        <feMergeNode in="coloredBlur" />
                                        <feMergeNode in="SourceGraphic" />
                                    </feMerge>
                                </filter>
                            </defs>
                            <circle stroke="rgba(255,255,255,0.03)" stroke-width="10" fill="transparent" r="155"
                                cx="175" cy="175" />
                            <circle id="timer-ring-fill" stroke="url(#neonGradient)" stroke-width="10"
                                stroke-dasharray="974" stroke-dashoffset="974" stroke-linecap="round" fill="transparent"
                                r="155" cx="175" cy="175" filter="url(#glow)"
                                style="transition: stroke-dashoffset 1s linear;" />
                        </svg>
                        <div class="timer-text" id="vault-timer">00:00</div>
                    </div>

                    <div class="timer-controls">
                        <button class="control-btn" onclick="openTimerSettings()"><i data-lucide="settings"></i> Manage
                            Timer</button>
                        <button class="control-btn primary" id="btn-play-pause" onclick="toggleTimer()"><i
                                data-lucide="play"></i> Start</button>
                        <button class="control-btn" onclick="exitFocus()"><i data-lucide="square"></i> Stop</button>
                    </div>

                    <div style="margin-top: 2rem; text-align: center;">
                        <h2 id="focus-title" style="font-size: 2rem; margin-bottom: 0.5rem;">Focus Session</h2>
                        <p id="focus-task" style="color: #94a3b8; font-size: 1.1rem;">Deep Work Protocol</p>
                    </div>
                </div>

                <!-- RIGHT: SIDEBAR -->
                <div class="focus-sidebar">
                    <!-- Stats -->
                    <div class="glass-panel">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-val" id="stat-xp" style="color: #d946ef;">0</span>
                                <span class="stat-lbl">XP Gained</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-val" id="stat-streak" style="color: #8b5cf6;">0</span>
                                <span class="stat-lbl">Streak</span>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <span class="stat-lbl" style="display: block; margin-bottom: 5px;">Current Rank</span>
                            <span id="stat-rank" style="font-weight: 800; color: white;">INITIATE</span>
                        </div>
                    </div>

                    <!-- Focus Stream -->
                    <div class="glass-panel" style="flex: 1;">
                        <div class="focus-card-header">FOCUS STREAM</div>
                        <div class="yt-frame" id="yt-frame">
                            <div
                                style="height: 100%; display: flex; align-items: center; justify-content: center; color: #64748b; background: rgba(0,0,0,0.5);">
                                <i data-lucide="image" style="width: 32px"></i>
                            </div>
                        </div>

                        <div class="stream-input-group">
                            <input type="text" id="yt-input" class="stream-input"
                                placeholder="Paste YouTube Link or Search...">
                            <button class="control-btn" style="padding: 0.5rem;" onclick="loadYT()"><i
                                    data-lucide="search"></i></button>
                        </div>

                        <div class="preset-grid">
                            <button class="control-btn" onclick="playPreset('lofi')"
                                style="justify-content: center; font-size: 0.8rem;">Lo-Fi</button>
                            <button class="control-btn" onclick="playPreset('rain')"
                                style="justify-content: center; font-size: 0.8rem;">Rain</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BOTTOM: MUSIC PLAYER -->
            <div class="music-bar">
                <div class="visualizer-container">
                    <!-- Simulated Equalizer Bars -->
                    <div class="v-bar" style="animation-delay: 0s"></div>
                    <div class="v-bar" style="animation-delay: 0.1s"></div>
                    <div class="v-bar" style="animation-delay: 0.2s"></div>
                    <div class="v-bar" style="animation-delay: 0.3s"></div>
                    <div class="v-bar" style="animation-delay: 0.4s"></div>
                    <div class="v-bar" style="animation-delay: 0.5s"></div>
                    <div class="v-bar" style="animation-delay: 0.6s"></div>
                    <div class="v-bar" style="animation-delay: 0.7s"></div>
                    <div class="v-bar" style="animation-delay: 0.8s"></div>
                    <div class="v-bar" style="animation-delay: 0.5s"></div>
                    <div class="v-bar" style="animation-delay: 0.2s"></div>
                    <div class="v-bar" style="animation-delay: 0s"></div>
                </div>

                <div class="player-controls">
                    <i data-lucide="skip-back" style="cursor: pointer;"></i>
                    <div class="play-cir" onclick="toggleTimer()">
                        <i data-lucide="play" id="bar-play-icon" style="fill: white;"></i>
                    </div>
                    <i data-lucide="skip-forward" style="cursor: pointer;"></i>
                </div>
            </div>
        </div>

        <script src="{{ url_for('static', filename='js/main.js') }}"></script>
        <script>lucide.createIcons();</script>
</body>

</html>